<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>çµ„åˆå±‹ææ–™æ¸…å–®å°ç…§è¡¨</title>
    <style>
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; margin: 20px; background: #f5f7fa; }
        .container { max-width: 1600px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        h1 { text-align: center; margin-bottom: 15px; color: #2c3e50; }
        .toolbar { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
        button { padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; background: #667eea; transition: 0.3s; }
        button:hover { background: #5566cc; }
        button.add-row { background: #51cf66; } 
        button.add-col { background: #f093fb; }
        button.export { background: #f5576c; }
        button.clear { background: #ff6b6b; }
        button.print { background: #4facfe; }
        table { border-collapse: collapse; width: 100%; font-size: 13px; }
        th, td { border: 2px solid #dee2e6; padding: 10px 8px; min-width: 80px; height: 40px; text-align: center; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold; position: sticky; top: 0; z-index: 10; }
        td[contenteditable="true"], th[contenteditable="true"] { background: white; cursor: text; }
        td:focus, th:focus { outline: 3px solid #4facfe; background: #fff; }
        .item { font-weight: 600; text-align: left; padding-left: 15px; }
        .delete-btn { cursor: pointer; color: red; font-weight: bold; user-select: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1 contenteditable="true">ğŸ› ï¸ å¤¾å±¤å¹³å°ææ–™æ¸…å–®å°ç…§è¡¨</h1>
        <div class="toolbar">
            <button class="add-row" onclick="addRow()">â• æ–°å¢ææ–™é …ç›®</button>
            <button class="add-col" onclick="addColumn()">â• æ–°å¢å°ºå¯¸æ¬„</button>
            <button class="export" onclick="exportTableToExcel()">ğŸ“Š åŒ¯å‡ºExcel</button>
            <button class="print" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
            <button class="clear" onclick="clearTable()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰å…§å®¹</button>
        </div>
        <table id="materialTable">
            <thead>
                <tr>
                    <th contenteditable="true">ææ–™é …ç›®</th>
                    <th contenteditable="true">3x6ç±³</th>
                    <th contenteditable="true">3x7ç±³</th>
                    <th contenteditable="true">3x8ç±³</th>
                    <th contenteditable="true">4x6ç±³</th>
                    <th contenteditable="true">4x7ç±³</th>
                    <th contenteditable="true">4x8ç±³</th>
                    <th contenteditable="true">5x6ç±³</th>
                    <th contenteditable="true">5x7ç±³</th>
                    <th contenteditable="true">5x8ç±³</th>
                    <th>åˆªé™¤åˆ—</th>
                </tr>
            </thead>
            <tbody>
                <!-- ç¯„ä¾‹åˆ— -->
                <tr>
                    <td contenteditable="true" class="item">åœ°æ¿</td>
                    <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                    <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                    <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                    <td><span class="delete-btn" onclick="deleteRow(this)">Ã—</span></td>
                </tr>
                <tr>
                    <td contenteditable="true" class="item">åº«ç‰ˆ</td>
                    <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                    <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                    <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                    <td><span class="delete-btn" onclick="deleteRow(this)">Ã—</span></td>
                </tr>
                <!-- å¯åˆªé™¤åˆ—ç¯„ä¾‹çµæŸ -->
            </tbody>
        </table>
    </div>
    <script>
        // æ–°å¢ææ–™é …ç›®
        function addRow() {
            const table = document.getElementById('materialTable').getElementsByTagName('tbody')[0];
            const cols = table.rows[0].cells.length;
            const newRow = table.insertRow();
            for(let i=0; i < cols; i++){
                let newCell = newRow.insertCell(i);
                if(i===0) {
                    newCell.contentEditable = "true";
                    newCell.className = "item";
                } else if(i === cols - 1){
                    newCell.innerHTML = '<span class="delete-btn" onclick="deleteRow(this)">Ã—</span>';
                } else {
                    newCell.contentEditable = "true";
                }
            }
            saveTableData();
        }
        // æ–°å¢å°ºå¯¸æ¬„ä½
        function addColumn() {
            const table = document.getElementById('materialTable');
            // é ­åˆ—æ–°å¢æ¬„ä½
            const headRow = table.tHead.rows[0];
            const headRow2 = table.tHead.rows[1];
            const newTH1 = document.createElement('th');
            newTH1.contentEditable = "true";
            newTH1.innerText = "æ–°å°ºå¯¸";
            headRow.appendChild(newTH1);
            const newTH2 = document.createElement('th');
            newTH2.contentEditable = "true";
            newTH2.innerText = "";
            headRow2.appendChild(newTH2);
            // tbodyæ–°å¢æ¬„ä½
            const rows = table.tBodies[0].rows;
            for(let r=0; r<rows.length; r++) {
                const newTD = rows[r].insertCell(-1);
                newTD.contentEditable = "true";
            }
            // åˆªé™¤æ¬„ä½å¯«æ­»åœ¨å€’æ•¸ç¬¬1æ¬„ï¼Œéœ€å°‡åˆªé™¤æ¬„ä½cellç§»åˆ°æœ€å¾Œ
            for(let r=0; r<rows.length; r++) {
                let delCell = rows[r].cells[rows[r].cells.length-2];
                rows[r].appendChild(delCell);
            }
            saveTableData();
        }
        // åˆªé™¤åˆ—
        function deleteRow(elm) {
            if(confirm("ç¢ºå®šåˆªé™¤æ­¤é …ç›®ï¼Ÿ")) {
                const row = elm.parentNode.parentNode;
                row.parentNode.removeChild(row);
                saveTableData();
            }
        }
        // å„²å­˜åˆ°LocalStorage
        function saveTableData() {
            const table = document.getElementById('materialTable');
            const data = [];
            for(let i = 0; i < table.rows.length; i++) {
                let rowdata = [];
                for(let j = 0; j < table.rows[i].cells.length - 1; j++) {
                    rowdata.push(table.rows[i].cells[j].innerText.trim());
                }
                data.push(rowdata);
            }
            localStorage.setItem('materialTable', JSON.stringify(data));
        }
        // è¼‰å…¥LocalStorageè³‡æ–™
        function loadTableData() {
            const data = JSON.parse(localStorage.getItem('materialTable'));
            if(!data) return;
            const table = document.getElementById('materialTable');
            // æ¸…ç©ºtbody
            const tbody = table.tBodies[0];
            tbody.innerHTML = '';
            // å…ˆé‡å»ºtheadéƒ¨åˆ†ï¼ˆåªé‡å»ºç¬¬ä¸€è¡Œï¼Œå‡è¨­ç¬¬äºŒè¡Œç‚ºç©ºæˆ–å¿½ç•¥ï¼‰
            const thead = table.tHead;
            thead.rows[0].innerHTML = '';
            data[0].forEach(text => {
                let th = document.createElement('th');
                th.contentEditable = "true";
                th.innerText = text;
                thead.rows[0].appendChild(th);
            });
            // é€è¡Œæ·»åŠ tbody
            for(let r=1; r<data.length; r++) {
                let newRow = tbody.insertRow();
                data[r].forEach((text, i) => {
                    let newCell = newRow.insertCell(i);
                    newCell.contentEditable = "true";
                    if(i===0) newCell.className = "item";
                    newCell.innerText = text;
                });
                // åˆªé™¤æŒ‰éˆ•
                let delCell = newRow.insertCell(-1);
                delCell.innerHTML = '<span class="delete-btn" onclick="deleteRow(this)">Ã—</span>';
            }
        }
        // åŒ¯å‡º Excel (ç°¡æ˜“CSV)
        function exportTableToExcel() {
            let table = document.getElementById("materialTable");
            let csv = [];
            for (let row of table.rows) {
                let cols = [];
                for(let cell of row.cells){
                    cols.push('"' + cell.innerText.replace(/"/g, '""') + '"');
                }
                csv.push(cols.join(","));
            }
            let csvString = csv.join("\n");
            let blob = new Blob([csvString], {type: 'text/csv'});
            let url = URL.createObjectURL(blob);
            let a = document.createElement("a");
            a.href = url;
            a.download = "material-list.csv";
            a.click();
            URL.revokeObjectURL(url);
        }
        // æ¸…ç©ºè¡¨æ ¼æ‰€æœ‰å…§å®¹
        function clearTable() {
            if(confirm("ç¢ºå®šæ¸…ç©ºæ•´å¼µè¡¨æ ¼å†…å®¹å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚")) {
                const table = document.getElementById('materialTable');
                const tbody = table.tBodies[0];
                tbody.innerHTML = '';
                // ä¿ç•™è¡¨é ­ç¬¬ä¸€è¡Œæ¨™é¡Œå…§å®¹ï¼Œä¸å‹•
                saveTableData();
            }
        }
        // ç›£æ§å…§å®¹è®Šå‹•è‡ªå‹•å„²å­˜
        document.getElementById('materialTable').addEventListener('input', saveTableData);
        window.onload = loadTableData;
    </script>
</body>
</html>
